---
title: "final project_GMC"
output: 
  html_document: 
    toc: yes
---

# 1.Set b, response

## BEST LM  

```{r,eval=TRUE}
load("../Rdata/b_aic_stepwise.RData")
bestmodel<- b_aic_stepwise 
```

## GMC  

find the optimal subset of X which make the $GMC(Y|X_{sub})$ or $GMC(Y|G(X_{sub}))$ largest!

subset: from the previous results  
link function(g())


$$Maximize~~GMC(Y|g(X))-lambda1(cov(g(X),Y))-lambda2 (lasso)$$

$$g(x)=x~~ linear~~ model$$ 

```{r,eval=TRUE}
g1<-function(x){
  return(x)
}
source("../Script/GMC.R")
xb<- bestmodel$fitted.values
data<-cbind(g1(xb),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X))
```


```{r,eval=TRUE}
#optimal beta
(initials<-bestmodel$coefficients)#initial beta  
require(parallel)
#optimal beta
rnge<- seq(0,2,by = 0.5)#lambda range
lambda1<- as.vector(sapply(rnge, function(x) rep(x,length(rnge))))
lambda2<- rnge
lambda.set <- rbind(lambda1, lambda2)
lambda.set <- as.data.frame(lambda.set);dim(lambda.set)

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g1(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

#OptEveryLambda1_b<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
#class(OptEveryLambda1_b)
#save(OptEveryLambda1_b, file = "Rdata/OptEveryLambda1_b.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda1_b.RData")
optgmc<-sapply(OptEveryLambda1_b, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda1_b[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
```  


$$g(x)= e^x Poisson~~ regression$$  

```{r,eval=TRUE}
g2<-function(x){
  return(exp(x))
}

data<-cbind(g2(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
```


```{r,eval=TRUE}
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g2(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda2_b<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda2_b)
# save(OptEveryLambda2_b, file = "Rdata/OptEveryLambda2_b.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda2_b.RData")
optgmc<-sapply(OptEveryLambda2_b, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda2_b[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
```  

$$sin(x)$$  

```{r}
g3<-function(x){
  return(sin(x))
}


data<-cbind(g3(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g3(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda3_b<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda3_b)
# save(OptEveryLambda3_b, file = "Rdata/OptEveryLambda3_b.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda3_b.RData")

optgmc<-sapply(OptEveryLambda3_b, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda3_b[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])

```

$$g(x)= x^2$$

```{r}
g4<-function(x){
  return(x^2)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g4(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda4_b<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda4_b)
# save(OptEveryLambda4_b, file = "Rdata/OptEveryLambda4_b.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")

load("../Rdata/OptEveryLambda4_b.RData")

optgmc<-sapply(OptEveryLambda4_b, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda4_b[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])

```  


$$g(x)=x^3$$

```{r}
g5<-function(x){
  return(x^3)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g5(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda5_b<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda5_b)
# save(OptEveryLambda5_b, file = "Rdata/OptEveryLambda5_b.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")

load("../Rdata/OptEveryLambda5_b.RData")
optgmc<-sapply(OptEveryLambda5_b, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda5_b[[which.max(optgmc)]]) # the optimal estimate for lambda1,2 and betas,and the GMC value

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
```

## BEST GLM  
```{r}
glmfunc<- c(g1,g2,g3,g4,g5)
findgmc<-function(g){
  xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
  fit.n<-g(xb)
  data<-cbind(fit.n, bestmodel$model$y)#X,Y
  return(GMC(data)[2])
}

gmcs<-sapply(glmfunc, FUN = findgmc)#compute gmc for each glm
glmfunc[which.max(gmcs)]
```

# 2.Set C, response 

## BEST LM  

```{r,eval=TRUE}
rm(list = ls())
load("../Rdata/c_aic_stepwise.RData")
bestmodel<- c_aic_stepwise
```

## GMC  

find the optimal subset of X which make the $GMC(Y|X_{sub})$ or $GMC(Y|G(X_{sub}))$ largest!

subset: from the previous results  
link function(g())


$$Maximize~~GMC(Y|g(X))-lambda1(cov(g(X),Y))-lambda2 (lasso)$$

$$g(x)=x~~ linear~~ model$$ 

```{r,eval=TRUE}
g1<-function(x){
  return(x)
}
source("../Script/GMC.R")
xb<- bestmodel$fitted.values
data<-cbind(g1(xb),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X))
```

```{r,eval=TRUE}
#optimal beta
(initials<-bestmodel$coefficients)#initial beta  
require(parallel)
#optimal beta
rnge<- seq(0,2,by = 0.5)#lambda range
lambda1<- as.vector(sapply(rnge, function(x) rep(x,length(rnge))))
lambda2<- rnge
lambda.set <- rbind(lambda1, lambda2)
lambda.set <- as.data.frame(lambda.set);dim(lambda.set)

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g1(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda1_c<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda1_c)
# save(OptEveryLambda1_c, file = "Rdata/OptEveryLambda1_c.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda1_c.RData")
optgmc<-sapply(OptEveryLambda1_c, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda1_c[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
```  


$$g(x)= e^x Poisson~~ regression$$  

```{r,eval=TRUE}
g2<-function(x){
  return(exp(x))
}

data<-cbind(g2(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
```


```{r,eval=TRUE}
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g2(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda2_c<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda2_c)
# save(OptEveryLambda2_c, file = "Rdata/OptEveryLambda2_c.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda2_c.RData")
optgmc<-sapply(OptEveryLambda2_c, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda2_c[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
```  

$$sin(x)$$  

```{r}
g3<-function(x){
  return(sin(x))
}


data<-cbind(g3(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g3(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda3_c<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda3_c)
# save(OptEveryLambda3_c, file = "Rdata/OptEveryLambda3_c.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda3_c.RData")
optgmc<-sapply(OptEveryLambda3_c, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda3_c[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])

```

$$g(x)= x^2$$

```{r}
g4<-function(x){
  return(x^2)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g4(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda4_c<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda4_c)
# save(OptEveryLambda4_c, file = "Rdata/OptEveryLambda4_c.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda4_c.RData")
optgmc<-sapply(OptEveryLambda4_c, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda4_c[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])

```  


$$g(x)=x^3$$

```{r}
g5<-function(x){
  return(x^3)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g5(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda5_c<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda5_c)
# save(OptEveryLambda5_c, file = "Rdata/OptEveryLambda5_c.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda5_c.RData")
optgmc<-sapply(OptEveryLambda5_c, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda5_c[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
``` 

## BEST GLM  
```{r}
glmfunc<- c(g1,g2,g3,g4,g5)
findgmc<-function(g){
  xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
  fit.n<-g(xb)
  data<-cbind(fit.n, bestmodel$model$y)#X,Y
  return(GMC(data)[2])
}

gmcs<-sapply(glmfunc, FUN = findgmc)#compute gmc for each glm
glmfunc[which.max(gmcs)]
```

# 3.Combine,response  

## BEST LM  

```{r,eval=TRUE}
rm(list = ls())
load("../Rdata/combine_aic_stepwise.RData")
bestmodel<-combine_aic_stepwise
```

## GMC  

find the optimal subset of X which make the $GMC(Y|X_{sub})$ or $GMC(Y|G(X_{sub}))$ largest!

subset: from the previous results  
link function(g())


$$Maximize~~GMC(Y|g(X))-lambda1(cov(g(X),Y))-lambda2 (lasso)$$

$$g(x)=x~~ linear~~ model$$ 

```{r,eval=TRUE}
g1<-function(x){
  return(x)
}
source("../Script/GMC.R")
xb<- bestmodel$fitted.values
data<-cbind(g1(xb),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X))
```


```{r,eval=TRUE}
#optimal beta
(initials<-bestmodel$coefficients)#initial beta  
require(parallel)
#optimal beta
rnge<- seq(0,2,by = 0.5)#lambda range
lambda1<- as.vector(sapply(rnge, function(x) rep(x,length(rnge))))
lambda2<- rnge
lambda.set <- rbind(lambda1, lambda2)
lambda.set <- as.data.frame(lambda.set);dim(lambda.set)

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g1(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda1_comb<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda1_comb)
# save(OptEveryLambda1_comb, file = "Rdata/OptEveryLambda1_comb.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda1_comb.RData")
optgmc<-sapply(OptEveryLambda1_comb, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda1_comb[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
```  


$$g(x)= e^x Poisson~~ regression$$  

```{r,eval=TRUE}
g2<-function(x){
  return(exp(x))
}

data<-cbind(g2(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
```


```{r,eval=TRUE}
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g2(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda2_comb<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda2_comb)
# save(OptEveryLambda2_comb, file = "Rdata/OptEveryLambda2_comb.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda2_comb.RData")
optgmc<-sapply(OptEveryLambda2_comb, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda2_comb[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
```  

$$sin(x)$$  

```{r}
g3<-function(x){
  return(sin(x))
}


data<-cbind(g3(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g3(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda3_comb<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda3_comb)
# save(OptEveryLambda3_comb, file = "Rdata/OptEveryLambda3_comb.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda3_comb.RData")
optgmc<-sapply(OptEveryLambda3_comb, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda3_comb[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])

```

$$g(x)= x^2$$

```{r}
g4<-function(x){
  return(x^2)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g4(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda4_comb<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda4_comb)
# save(OptEveryLambda4_comb, file = "Rdata/OptEveryLambda4_comb.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda4_comb.RData")
optgmc<-sapply(OptEveryLambda4_comb, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda4_comb[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])

```  


$$g(x)=x^3$$

```{r}
g5<-function(x){
  return(x^3)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$y)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g5(xb)
  resid<-bestmodel$model$y- fit.n
  data<-cbind(fit.n,bestmodel$model$y)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda5_comb<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda5_comb)
# save(OptEveryLambda5_comb, file = "Rdata/OptEveryLambda5_comb.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda5_comb.RData")
optgmc<-sapply(OptEveryLambda5_comb, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda5_comb[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$y)#X,Y
(gmc <- GMC(data)[2])
``` 
## BEST GLM  
```{r}
glmfunc<- c(g1,g2,g3,g4,g5)
findgmc<-function(g){
  xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
  fit.n<-g(xb)
  data<-cbind(fit.n, bestmodel$model$y)#X,Y
  return(GMC(data)[2])
}

gmcs<-sapply(glmfunc, FUN = findgmc)#compute gmc for each glm
glmfunc[which.max(gmcs)]
```


# 4.Set b, TP53   

## BEST LM  

```{r,eval=TRUE}
load("../Rdata/b_aic_forward_t.RData")
bestmodel<- b_aic_forward_t
```

## GMC  

find the optimal subset of X which make the $GMC(Y|X_{sub})$ or $GMC(Y|G(X_{sub}))$ largest!

subset: from the previous results  
link function(g())


$$Maximize~~GMC(Y|g(X))-lambda1(cov(g(X),Y))-lambda2 (lasso)$$

$$g(x)=x~~ linear~~ model$$ 

```{r,eval=TRUE}
g1<-function(x){
  return(x)
}
source("../Script/GMC.R")
xb<- bestmodel$fitted.values
data<-cbind(g1(xb),bestmodel$model$TP53)#X,Y
GMC(data) #(GMC(X|Y),GMC(Y|X))

```


```{r,eval=TRUE}
#optimal beta
(initials<-bestmodel$coefficients)#initial beta  
require(parallel)
#optimal beta
rnge<- seq(0,2,by = 0.5)#lambda range
lambda1<- as.vector(sapply(rnge, function(x) rep(x,length(rnge))))
lambda2<- rnge
lambda.set <- rbind(lambda1, lambda2)
lambda.set <- as.data.frame(lambda.set);dim(lambda.set)

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g1(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda1_bt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda1_bt)
# save(OptEveryLambda1_bt, file = "Rdata/OptEveryLambda1_bt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda1_bt.RData")

optgmc<-sapply(OptEveryLambda1_bt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda1_bt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```  


$$g(x)= e^x Poisson~~ regression$$  

```{r,eval=TRUE}
g2<-function(x){
  return(exp(x))
}

data<-cbind(g2(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
```


```{r,eval=TRUE}
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g2(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda2_bt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda2_bt)
# save(OptEveryLambda2_bt, file = "Rdata/OptEveryLambda2_bt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda2_bt.RData")

optgmc<-sapply(OptEveryLambda2_bt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda2_bt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```  

$$sin(x)$$  

```{r}
g3<-function(x){
  return(sin(x))
}


data<-cbind(g3(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g3(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda3_bt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda3_bt)
# save(OptEveryLambda3_bt, file = "Rdata/OptEveryLambda3_bt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda3_bt.RData")
optgmc<-sapply(OptEveryLambda3_bt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda3_bt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])

```

$$g(x)= x^2$$

```{r}
g4<-function(x){
  return(x^2)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g4(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda4_bt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda4_bt)
# save(OptEveryLambda4_bt, file = "Rdata/OptEveryLambda4_bt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda4_bt.RData")
optgmc<-sapply(OptEveryLambda4_bt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda4_bt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])

```  


$$g(x)=x^3$$

```{r}
g5<-function(x){
  return(x^3)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g5(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda5_bt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda5_bt)
# save(OptEveryLambda5_bt, file = "Rdata/OptEveryLambda5_bt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda5_bt.RData")
optgmc<-sapply(OptEveryLambda5_bt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda5_bt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```

## BEST GLM  
```{r}
glmfunc<- c(g1,g2,g3,g4,g5)
findgmc<-function(g){
  xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
  fit.n<-g(xb)
  data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
  return(GMC(data)[2])
}

gmcs<-sapply(glmfunc, FUN = findgmc)#compute gmc for each glm
glmfunc[which.max(gmcs)]
```

# 5.Set C, TP53   

## BEST LM  

```{r,eval=TRUE}
load("../Rdata/c_aic_stepwise_t.RData")
bestmodel<- c_aic_stepwise_t
```

## GMC  

find the optimal subset of X which make the $GMC(Y|X_{sub})$ or $GMC(Y|G(X_{sub}))$ largest!

subset: from the previous results  
link function(g())


$$Maximize~~GMC(Y|g(X))-lambda1(cov(g(X),Y))-lambda2 (lasso)$$

$$g(x)=x~~ linear~~ model$$ 

```{r,eval=TRUE}
g1<-function(x){
  return(x)
}
source("../Script/GMC.R")
xb<- bestmodel$fitted.values
data<-cbind(g1(xb),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X))
```


```{r,eval=TRUE}
#optimal beta
(initials<-bestmodel$coefficients)#initial beta  
require(parallel)
#optimal beta
rnge<- seq(0,2,by = 0.5)#lambda range
lambda1<- as.vector(sapply(rnge, function(x) rep(x,length(rnge))))
lambda2<- rnge
lambda.set <- rbind(lambda1, lambda2)
lambda.set <- as.data.frame(lambda.set);dim(lambda.set)

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g1(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda1_ct<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda1_ct)
# save(OptEveryLambda1_ct, file = "Rdata/OptEveryLambda1_ct.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda1_ct.RData")
optgmc<-sapply(OptEveryLambda1_ct, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda1_ct[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```  


$$g(x)= e^x Poisson~~ regression$$  

```{r,eval=TRUE}
g2<-function(x){
  return(exp(x))
}

data<-cbind(g2(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
```


```{r,eval=TRUE}
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g2(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda2_ct<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda2_ct)
# save(OptEveryLambda2_ct, file = "Rdata/OptEveryLambda2_ct.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda2_ct.RData")
optgmc<-sapply(OptEveryLambda2_ct, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda2_ct[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```  

$$sin(x)$$  

```{r}
g3<-function(x){
  return(sin(x))
}


data<-cbind(g3(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g3(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda3_ct<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda3_ct)
# save(OptEveryLambda3_ct, file = "Rdata/OptEveryLambda3_ct.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda3_ct.RData")

optgmc<-sapply(OptEveryLambda3_ct, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda3_ct[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])

```

$$g(x)= x^2$$

```{r}
g4<-function(x){
  return(x^2)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g4(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda4_ct<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda4_ct)
# save(OptEveryLambda4_ct, file = "Rdata/OptEveryLambda4_ct.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda4_ct.RData")
optgmc<-sapply(OptEveryLambda4_ct, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda4_ct[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])

```  


$$g(x)=x^3$$

```{r}
g5<-function(x){
  return(x^3)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g5(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda5_ct<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda5_ct)
# save(OptEveryLambda5_ct, file = "Rdata/OptEveryLambda5_ct.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")

load("../Rdata/OptEveryLambda5_ct.RData")
optgmc<-sapply(OptEveryLambda5_ct, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda5_ct[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```

## BEST GLM  
```{r}
glmfunc<- c(g1,g2,g3,g4,g5)
findgmc<-function(g){
  xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
  fit.n<-g(xb)
  data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
  return(GMC(data)[2])
}

gmcs<-sapply(glmfunc, FUN = findgmc)#compute gmc for each glm
glmfunc[which.max(gmcs)]
```  

# 6.Combine, TP53  

## BEST LM  

```{r,eval=TRUE}
load("../Rdata/combine_aic_forward_t.RData")
bestmodel<- combine_aic_forward_t
```

## GMC  

find the optimal subset of X which make the $GMC(Y|X_{sub})$ or $GMC(Y|G(X_{sub}))$ largest!

subset: from the previous results  
link function(g())


$$Maximize~~GMC(Y|g(X))-lambda1(cov(g(X),Y))-lambda2 (lasso)$$

$$g(x)=x~~ linear~~ model$$ 

```{r,eval=TRUE}
g1<-function(x){
  return(x)
}
source("../Script/GMC.R")
xb<- bestmodel$fitted.values
data<-cbind(g1(xb),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X))
```


```{r,eval=TRUE}
#optimal beta
(initials<-bestmodel$coefficients)#initial beta  
require(parallel)
#optimal beta
rnge<- seq(0,2,by = 0.5)#lambda range
lambda1<- as.vector(sapply(rnge, function(x) rep(x,length(rnge))))
lambda2<- rnge
lambda.set <- rbind(lambda1, lambda2)
lambda.set <- as.data.frame(lambda.set);dim(lambda.set)

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g1(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda1_combt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda1_combt)
# save(OptEveryLambda1_combt, file = "Rdata/OptEveryLambda1_combt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda1_combt.RData")
optgmc<-sapply(OptEveryLambda1_combt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda1_combt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```  


$$g(x)= e^x Poisson~~ regression$$  

```{r,eval=TRUE}
g2<-function(x){
  return(exp(x))
}

data<-cbind(g2(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
```


```{r,eval=TRUE}
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g2(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda2_combt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda2_combt)
# save(OptEveryLambda2_combt, file = "Rdata/OptEveryLambda2_combt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda2_combt.RData")
optgmc<-sapply(OptEveryLambda2_combt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda2_combt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```  

$$sin(x)$$  

```{r}
g3<-function(x){
  return(sin(x))
}


data<-cbind(g3(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g3(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda3_combt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda3_combt)
# save(OptEveryLambda3_combt, file = "Rdata/OptEveryLambda3_combt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda3_combt.RData")
optgmc<-sapply(OptEveryLambda3_combt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda3_combt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])

```

$$g(x)= x^2$$

```{r}
g4<-function(x){
  return(x^2)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g4(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda4_combt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda4_combt)
# save(OptEveryLambda4_combt, file = "Rdata/OptEveryLambda4_combt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda4_combt.RData")
optgmc<-sapply(OptEveryLambda4_combt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda4_combt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])

```  


$$g(x)=x^3$$

```{r}
g5<-function(x){
  return(x^3)
}


data<-cbind(g4(bestmodel$fitted.values),bestmodel$model$TP53)#X,Y
GMC(data)#(GMC(X|Y),GMC(Y|X)) 
#require(parallel)
#optimal beta

findopt<-function(lambda){
  lambda1<-lambda[1];lambda2<-lambda[2]
  fn<-function(beta){
  xb= as.matrix(bestmodel$model[-1]) %*% beta[-1]+beta[1]
  fit.n<-g5(xb)
  resid<-bestmodel$model$TP53- fit.n
  data<-cbind(fit.n,bestmodel$model$TP53)#X,Y
  return(-GMC(data)[2]+ lambda1*var(fit.n,resid)+lambda2*sum(abs(beta)))
 }
  
  opt<-optim(par = initials, fn =fn, method = "Nelder-Mead" )
  return(c(lambda,opt$par,-opt$value))
}

# OptEveryLambda5_combt<-mclapply(lambda.set, FUN = findopt,mc.cores=4)
# class(OptEveryLambda5_combt)
# save(OptEveryLambda5_combt, file = "Rdata/OptEveryLambda5_combt.RData")
#colnames(OpetEveryLambda)[c(1,2,)]<- c("lambda1","lambda2","GMC(Y|G(X))+lasso")
load("../Rdata/OptEveryLambda5_combt.RData")

optgmc<-sapply(OptEveryLambda5_combt, function(x) return(x[c(length(x))]))
(optgmc<- OptEveryLambda5_combt[[which.max(optgmc)]])

xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
fit.n<-g1(xb)
data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
(gmc <- GMC(data)[2])
```

## BEST GLM  
```{r}
glmfunc<- c(g1,g2,g3,g4,g5)
findgmc<-function(g){
  xb<- as.matrix(bestmodel$model[-1]) %*% optgmc[c(-1,-2,-3,-length(optgmc))] + optgmc[3]
  fit.n<-g(xb)
  data<-cbind(fit.n, bestmodel$model$TP53)#X,Y
  return(GMC(data)[2])
}

gmcs<-sapply(glmfunc, FUN = findgmc)#compute gmc for each glm
glmfunc[which.max(gmcs)]
```